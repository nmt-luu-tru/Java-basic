### Vòng đời của đối tượng trong JAVA

Lập trình viên khi làm việc với đối tượng thường tập trung vào cách viết code sao cho chương trình hoạt động đúng và không gặp lỗi. Tuy nhiên, việc hiểu rõ bản chất và vòng đời của đối tượng lại rất quan trọng, giúp tránh được nhiều lỗi không đáng có và cải thiện hiệu suất chương trình.

Trong bài viết này, chúng ta sẽ tìm hiểu về vòng đời của đối tượng trong Java, từ cách đối tượng được tạo ra, nó tồn tại như thế nào, cho đến cách hủy đối tượng khi không còn cần thiết.

#### 1. Tìm hiểu về vòng đời của đối tượng

Trong Java, khi đối tượng được tạo ra, nó sẽ được lưu trữ trong bộ nhớ Heap, trong khi các phương thức và **local variables** (biến địa phương) được lưu trữ trong Stack. Java có hai vùng bộ nhớ quan trọng:

- **Heap**: Là nơi lưu trữ các đối tượng.
- **Stack**: Là nơi lưu trữ các phương thức đang thực thi và các **local variables**.

##### Instance variable và Local variable

- **Instance variable**: Được khai báo bên trong một lớp, đại diện cho các thuộc tính của đối tượng. Các **instance variables** "sống" bên trong đối tượng chủ của chúng, tức là trong vùng Heap.

```java
public class ConBo {
    double canNang;  // Instance variable
}
```

- **Local variable**: Được khai báo trong phương thức và chỉ tồn tại trong phạm vi của phương thức đó. Khi phương thức kết thúc, các **local variables** sẽ bị hủy.

```java
public void ahihi(int x) {
    int y = x++;  // Local variable
}
```

##### Đối với các local variables là đối tượng

Trong Java, **local variable** của kiểu không cơ bản (non-primitive) thực chất là tham chiếu đến đối tượng, không phải chính đối tượng. Đối tượng vẫn được lưu trữ trong Heap, mặc dù tham chiếu đến đối tượng nằm trong Stack.

```java
public void ahihi(int x) {
    int y = x++;
    ConBo conBo = new ConBo();  // Local variable kiểu đối tượng
}
```

##### Vị trí của Instance variable

Các **instance variables** tồn tại trong vùng nhớ của đối tượng chủ tại Heap. Khi sử dụng từ khóa `new`, Java cấp phát bộ nhớ cho đối tượng và các **instance variables** của đối tượng đó.

Nếu **instance variable** thuộc kiểu dữ liệu cơ bản như `int` hay `double`, vùng nhớ sẽ được cấp phát tương ứng với kích thước của kiểu dữ liệu. Nếu **instance variable** là một đối tượng khác, thì chỉ có tham chiếu được lưu trong vùng nhớ, còn đối tượng thật vẫn nằm trong Heap.

```java
ConBo conBo = new ConBo();
TestConBo test = new TestConBo();
```

#### 2. Khi nào đối tượng được cấp phát và hủy

Một đối tượng chỉ được tạo ra khi từ khóa `new` được sử dụng, và sẽ tồn tại trong Heap cho đến khi không còn bất kỳ tham chiếu nào trỏ đến nó. Khi không còn tham chiếu nào, đối tượng sẽ trở thành "rác" và Garbage Collector sẽ thu hồi vùng nhớ.

##### Các cách hủy tham chiếu đến đối tượng

- **Tham chiếu vượt ra khỏi phạm vi tồn tại**: Khi phương thức kết thúc, các **local variables** bên trong phương thức cũng sẽ bị hủy.

```java
public void ahihi() {
    ConBo conBo = new ConBo();  // Tham chiếu sẽ bị hủy khi phương thức kết thúc
}
```

- **Tham chiếu trỏ đến đối tượng khác**: Khi một tham chiếu trỏ đến đối tượng mới, đối tượng cũ sẽ bị bỏ rơi và được Garbage Collector thu dọn.

```java
public void ahihi() {
    ConBo conBo = new ConBo();
    conBo = new ConBo();  // Đối tượng đầu tiên bị bỏ rơi
}
```

- **Tham chiếu được gán giá trị null**: Khi tham chiếu bị gán giá trị `null`, đối tượng mà nó trỏ tới sẽ không còn khả năng truy cập được nữa.

```java
public void ahihi() {
    ConBo conBo = new ConBo();
    conBo = null;  // Mất dấu đối tượng, đối tượng bị hủy
}
```

#### 3. Cách hủy tham chiếu đến đối tượng

Trong Java, có ba cách để hủy tham chiếu tới một đối tượng:

- **Tham chiếu vượt ra ngoài phạm vi tồn tại**: Khi phương thức kết thúc, các **local variables** bên trong cũng sẽ bị hủy.
- **Tham chiếu trỏ đến đối tượng khác**: Khi tham chiếu trỏ đến đối tượng mới, đối tượng cũ sẽ không còn được sử dụng.
- **Tham chiếu gán giá trị null**: Khi tham chiếu được gán giá trị `null`, đối tượng mà nó trỏ tới sẽ bị coi là "rác".

#### 4. Tổng kết

Hiểu rõ về vòng đời của đối tượng trong Java là một kiến thức quan trọng giúp lập trình viên quản lý bộ nhớ tốt hơn, tránh các lỗi như tràn bộ nhớ hay lỗi tham chiếu null. Dù đây chỉ là một phần kiến thức nhỏ, nhưng nó có thể giúp lập trình viên tối ưu hóa chương trình và tránh những vấn đề phức tạp về quản lý bộ nhớ trong tương lai.
